New-StoragePool �FriendlyName "WinStorePool" �PhysicalDisks (Get-PhysicalDisk PhysicalDisk1, PhysicalDisk2,PhysicalDisk3 ) �StorageSubSystemFriendlyName *Store*



New-VirtualDisk �StoragePoolFriendlyName "WinStorePool" �FriendlyName VDisk1 �NumberOfColumns 1 �ProvisioningType Fixed �ResiliencySettingName Simple -UseMaximumSize



https://docs.microsoft.com/en-us/powershell/module/storage/new-storagepool?view=win10-ps
This line creates a new storage pool using the $PhysicalDisks variable to specify the disks to include from the WindowsStorage subsystem (specified with a wildcard * to remove the need to modify the friendly name for different computers).
PS C:\> New-StoragePool -FriendlyName CompanyData -StorageSubsystemFriendlyName "Windows Storage*" -PhysicalDisks $PhysicalDisks




The first line ($PhysicalDisks =...) gets the storage subsystem object for the Windows Storage subsystem, passes it to the **Get-PhysicalDisk** cmdlet, which then gets the physical disks in the specified subsystem that are available to add to a storage pool, and assigns these disks to the $PhysicalDisks variable.

The second line of the command has five parts, connected by the pipeline (|). The first part (New-StoragePool...) creates a new storage pool using the physical disks in the $PhysicalDisks variable, and then passes the new storage pool down the pipeline. All of the following commands are logically part of one command and should be entered as such.

The second part (New-VirtualDisk...) creates a new virtual disk on the passed in storage pool and then passes the new virtual disk down the pipeline.

The third part (Initialize-Disk...) initializes the disk that was passed in, and then passes the disk down the pipeline.

The fourth part (New-Partition...) creates a new partition on the disk that was passed in, assigns it the next available drive letter, and then passes the partition down the pipeline.

The final part of the command (Format-Volume) formats the partition that was passed in.

$PhysicalDisks = Get-StorageSubSystem -FriendlyName "Windows Storage*" | Get-PhysicalDisk -CanPool $True 

New-StoragePool -FriendlyName "CompanyData" -StorageSubsystemFriendlyName "Windows Storage*" -PhysicalDisks $PhysicalDisks |New-VirtualDisk -FriendlyName "UserData" -Size 100GB -ProvisioningType Thin |Initialize-Disk -PassThru |New-Partition -AssignDriveLetter -UseMaximumSize |Format-Volume


-------------------------------------------------------------------------------------------------------------------



New-StoragePool -FriendlyName WinStorePool -StorageSubsystemFriendlyName "Windows Storage*" -PhysicalDisks $PhysicalDisks -ResiliencySettingNameDefault Parity -ProvisioningTypeDefault Fixed -Verbose -LogicalSectorSizeDefault 4096 -FaultDomainAwarenessDefault PhysicalDisk


-LogicalSectorSizeDefault 4096



-FaultDomainAwarenessDefault PhysicalDisk


-ResiliencySettingNameDefault Parity




1:38 PM 8/31/2019
this worked to create to pool:
New-StoragePool -FriendlyName WinStorePool -StorageSubsystemFriendlyName "Windows Storage*" -PhysicalDisks $PhysicalDisks -ResiliencySettingNameDefault Parity -ProvisioningTypeDefault Fixed -Verbose -LogicalSectorSizeDefault 4096 -FaultDomainAwarenessDefault PhysicalDisk

using server manager i removed physical disk 4 and added it back as a "hot spare"


-------------------------------------------------------------------------------------------------------------------

virtual disk...

1:48 PM 8/31/2019

already made pool "parity". not sure if both disk and pool should be parity. or if it matters. or maybe
pool should have been simple and disk should have been parity

unclear on values for this. i think just an integer. so i'll go with 1 for "virtual disk can telerate 1 failed physical disk"
-PhysicalDiskRedundancy 1

-ProvisioningType fixed


for this i was going to use 4 instead of 5 so i can see if it lets me add one
-PhysicalDisksToUse 4


again, unclear on necessity
-ResiliencySettingName Parity

i assume this will make it easy
-UseMaximumSize




original virtual disk line from that blog
New-VirtualDisk �StoragePoolFriendlyName "WinStorePool" �FriendlyName VDisk1 �NumberOfColumns 1 �ProvisioningType Fixed �ResiliencySettingName Simple -UseMaximumSize -PhysicalDiskRedundancy 1 



i think it would be better to just leave this resiliency as simple



ended up using this line

New-VirtualDisk -StoragePoolFriendlyName "WinStorePool" -FriendlyName VDisk1 -NumberOfColumns 1 -ProvisioningType Fixed -ResiliencySettingName Simple -UseMaximumSize

the physical disk reduencancy was never going to work
and that number of disks to use even if i had the right information for would not have worked either




as experiment, before initilizing the disk to make a volume/drive letter/format, 
I removed one disk from the pool
then created the volume and formatted
then tried to add the disk back to pool but it wouldn't give me the option
so i set the disk to offline
then it would let me add the disk to the pool
and i was able to "extend" the volume

I had to extend the volume and the virtual disk before the new volume size would show up
and finally bring the disk back online


my next experiment i will leave some data on the volume (I called it S:)
and then power off the server and physically pull out a disk sled
and see if the hot spare does anything or if that is not worth bothering with




first i wanted to run "optimize storage pool" just to see what happens
Optimize-StoragePool -FriendlyName WinStorePool
it's supposed to "rebalance" the content of the pool. i'm not sure what it will do in this context
or what it did
there is about 100MB worth of data on there but
well i ran it and there was just a progress bar there for a second and it stopped
so really i have no idea


okay now i'll try the physical remove thing
only problem not sure which physical disk is the hot spare
the get-physical disk cmdlet says the SSD is 0
and the "hot spare" disk is disk 5
there is a serial number actually
if i wanted to not remove the hotspare but
but say disk 4
the end of that sn is 04169 and it's a WD 1TB

after removing the physical disk and powering it back up
none of the disks are flagged as "hot spare"
and the disk that's missing has a yellow exclamation point next to it
but i can't remove the "failed" disk from the pool
it only says to delete the virtual disk first
seems like that kind of defeats the purpose of a "hot spare"

i tried taking the virtual disk offline
and detatching it
but it doesn't seem to make a difference:
---------------------------
Remove Physical Disk
---------------------------
This physical disk is used by one or more virtual disks that use the Simple (no resiliency) layout. To remove this physical disk, delete the following virtual disks: VDisk1
---------------------------
OK   
---------------------------


so /apparently/ i should have made the virtual disk with resiliency/parity. still not sure if both pool and vdisk
should be made with resiliency but i'm leaning toward not
also not sure if hot spare is worth bothering with


I tried 
Repair-VirtualDisk -FriendlyName VDisk1
to see if it would help. i doubt it. worth a shot.


-------------------------------------------------------------------------------------------------------------------

2:03 PM 9/1/2019

i re-inserted the removed hdd
the pool and vdisk both came back to healthy
the disk previously designated hot spare was had a value of "retired" in the "usage" column


i watched this video
https://www.youtube.com/watch?v=Sp6OW5Xx7jA
he used the server manager wizard to create the pool
he DIDN'T use parity for the pool (also didn't specify hot spare in pool)
and DID use the parity for the vdisk

i think it may be possitlbe to later set the "usage" attribute to "hot spare"
also, I don't think "hot spare" means what I think it means

on the vdisk part he made a pretty good case for thin provisioned disks:
can specify smaller size then the max
and as data is added it will expand/grow




also talks about storage tiers" a little



i saw elsewhere the "Friendly name" of the hdds can be set
so i could hypothetically set the disk as "slot 0" or whatever
that could be helpful



3:09 PM 9/1/2019
I am going to modify this line so I am only using 3 disks and non-parity/no hotspares 

(original)
New-StoragePool -FriendlyName WinStorePool -StorageSubsystemFriendlyName "Windows Storage*" -PhysicalDisks $PhysicalDisks -ResiliencySettingNameDefault Parity -ProvisioningTypeDefault Fixed -Verbose -LogicalSectorSizeDefault 4096 -FaultDomainAwarenessDefault PhysicalDisk

new/modified
I am going to have to either write out each friendly name of disk i want to use or re-define that $PhysicalDisks variable
i could probably go by device ID instead, just 1, 2 and 3
they're all 1TB and i'm just manually looking to see that they all say their "canpool" is true

based on the prior line to define that variable, I first run 
Get-StorageSubSystem
to see the name of my sotrage sub system:
Windows Storage on 2k19r520

So i use this to construct the first part of the variable:


$PhysicalDisks = Get-StorageSubSystem -FriendlyName "Windows Storage*"

I ended up going on something of wild goose chase so i could use a variable for the disks i wanted to use to start in the pool
I just wanted 3 of them and the 1TB ones 
not sure how long it took but here's what i came up with:

$PhysicalDisks = Get-PhysicalDisk -CanPool $True | Where-Object -filter { $_.DeviceID -lt 5 } | sort  descending |select -last 3

this will show disks with ID 1, 3 and 4 all of which are 1TB


so NEW storage pool line:
New-StoragePool -FriendlyName WinStorePool -StorageSubsystemFriendlyName "Windows Storage*" -PhysicalDisks $PhysicalDisks 

I decided to simplify it a little this time. I don't think i even need that resiliency specification. I'll just leave
on the defaults and hope the defaults will work.

THIS COMMAND APPARENTLY WORKED


now for the virtual disk. This one will get interesting.
I think I'm going to go for "thin" this time and obviously parity

here is ORIGINAL virtual disk line from above:
New-VirtualDisk -StoragePoolFriendlyName "WinStorePool" -FriendlyName VDisk1 -NumberOfColumns 1 -ProvisioningType Fixed -ResiliencySettingName Simple -UseMaximumSize

and this is the NEW virtual disk line:
New-VirtualDisk -StoragePoolFriendlyName "WinStorePool" -FriendlyName VDisk1 -NumberOfColumns 1 -ProvisioningType Thin -ResiliencySettingName Parity 



New-VirtualDisk -StoragePoolFriendlyName "WinStorePool" -FriendlyName VDisk1 -NumberOfColumns 1 -ProvisioningType Fixed -ResiliencySettingName Parity -UseMaximumSize



no matter what i did i couldn't get the columns=1 thing to work
so looking the examples of "new virtudisk" online documentation (https://docs.microsoft.com/en-us/powershell/module/storage/new-virtualdisk?view=win10-ps) 
I finally up with this one
And this one DID WORK
yaaaa

New-VirtualDisk -StoragePoolFriendlyName "WinStorePool" -FriendlyName VDisk1 -ResiliencySettingName Parity  -Size 2TB -ProvisioningType thin -PhysicalDiskRedundancy 1

the main tests i want to run include - after putting some data in - simulating a "fail" of a disk and seeing if it's possible
to add a hdd later
and since i specified 2TB of initial size i should probably see if i can expand that.


in server manager under storage pools it says the capacity is 2.73TB while the freespace is 2.72 TB
I will probably just specify 2.5TB and go from there

First i will create the volume and format it as NTFS

first i brought the vdisk to "online"
it's showing with disk ID of 6

once formatted i copied in some data (my "repos" folder, it's about 100MBs)


attempting to expand virtual disk from 2TB to 2.2TB
it apparently worked without issue
data is still intact
although looking at S: volume on the server itself
it still says the capacity is 1.99TB
I'm not sure if that's because the .2 isn't significant enough
or if there's someting else i have to do for it acknowledge the space

in server manager
under "disks" at left
in the upper frame that lists all the disks with the disk numbers
the capacity of the vdisk is indeed "2.2TB"
But in the lower pane under "volumes"
the capacity remains at "2TB"
So I guess I have to "extend" it in both places
and this apparently worked
so first "extned virtual disk
then it's possible to "extend volume"
and this is indeed expressed on the server itself
with a new capacity of 2.19TB
and data is still intact

now i will try removing one of the drives
just removing the only one of the 3 that is samsung will make it easier
device id 3
sn S13PJDWQ728900

powered off server/removed samsung 1TB drive
powered back up
the storage pool and vidsk both are showing the famous yellow exclamation
but actually the S: drive is still there
and the data is intact
which is exactly what i wanted: resiliancy from a single disk fail
so now i will try adding in one of the previously unused 1TB disks
I added the disk successfully but the pool/vdisk is still in degraded/incomplete status

so i will now attempt to remove the samsung

This gave me an error about needing a replacement disk
which I thought i did

---------------------------
Remove Physical Disk
---------------------------
The selected physical disk cannot be removed.

Before removing a physical disk, you must add a replacement physical disk to the storage pool.

The replacement disk must be set to Automatic allocation, be equal in size or larger than the used space on this physical disk, and must not contain any part of a virtual disk.
---------------------------
OK   
---------------------------

/somehow/ i managed to get the non-existant samsung out the pool and off the list
along with adding the other 1TB disk to pool
not even sure i could reproduce that actually
i know i flagged the samsung as "retired" with this
Set-PhysicalDisk -FriendlyName "ATA SAMSUNG HD103UJ" -Usage Retired
then i tried the "update storage pool" (and answered 'y')
Update-StoragePool -FriendlyName "WinStorePool"

i then attempted to remove the disk through server manager
it went through progress bar window
and said successful
but the window actually got stuck
i couldn't get around or close the window
so after 45 minutes or so i finally did an "end task" on server manager
and now both the pool and the vdisk are showing as healthy
and data is intact

now just have to try adding the samsung back
as well as the 2TB hitachi
so how well it deals


one idea is actually to add the samsung back to the pool and flag it as a hotspare
then physically remove one of the other disks
and re-flag the hotspare as "auto select"
to see if it auto-picks it up


i re-inserted the samsung, deviceID 3, and it came up as unhealthy:
DeviceId FriendlyName            SerialNumber    MediaType   CanPool OperationalStatus           HealthStatus Usage
-------- ------------            ------------    ---------   ------- -----------------           ------------ -----
3        ATA SAMSUNG HD103UJ     S13PJDWQ728900  Unspecified False   {Unrecognized Metadata, OK} Unhealthy    Unknown


I tried reset disk:
Reset-PhysicalDisk -FriendlyName "ATA SAMSUNG HD103UJ"

this came back with a normal "operational status" - healthy - but the "mediatype" was still "unspecified"
so I set this:
Set-PhysicalDisk -FriendlyName "ATA SAMSUNG HD103UJ" -MediaType HDD


i'm going to try adding the disk with PS instead of server manager


$PDToAdd =  Get-PhysicalDisk -FriendlyName "10TB Slot ID1"
Add-PhysicalDisk -PhysicalDisks $PDToAdd -Usage AutoSelect -StoragePoolFriendlyName WinStorePool



this has apparently added the disk to the pool successfully
now i have to add the disk to the vdisk


this is a variation of the sample on the MS docs site
i'm sure this will work

Add-PhysicalDisk -VirtualDiskFriendlyName VDisk1 -PhysicalDisks $PDToAdd
apparently not


i'll try this one instead
Add-PhysicalDisk -VirtualDiskFriendlyName VDisk1 -PhysicalDisks (Get-PhysicalDisk -FriendlyName "ATA SAMSUNG HD103UJ")
that didn't work either


$PDToAdd = Get-PhysicalDisk -FriendlyName "ATA SAMSUNG HD103UJ"
Add-PhysicalDisk -PhysicalDisks $PDToAdd -VirtualDiskFriendlyName VDisk1



upon re-looking at server manager, i realize now that vdisk1 already has four disks
not sure when that happened or if it was one of my commands or i inadvertently used server manager
either way though it has all 4 disks now

now i need to extend both the volumn and the disk so it at least sees to possibility of the new size


so i'll try this with PS as well because why not


i think this cmdlet will work
Resize-VirtualDisk -FriendlyName "Sqldata5" -Size (25GB)

currently the vdisk is at capacity of 2.2TB
and the storage pool says it has a capacity of 3.63TB
so i'm going to raise it a little to 2.6TB

Resize-VirtualDisk -FriendlyName "Vdisk1" -Size (2.6TB)

this has apparently worked and Get-VirtualDisk is in fact coming back with size of 2.6TB

so next i have to extend the actual volume

the closest command i can find is Resize-Partition

this one has a weird example so i'm just going to base it partially on the vdisk example
Resize-Partition 


first i used get-partition to figure which partition i wanted to target and set that to a variable:
$SetPartToSize = Get-Partition -DriveLetter S


not sure this will work
Resize-Partition $SetPartToSize -size (2.5TB)
apparently it really wants an integer
so I used get-disk to figure out the vdisk is disk 6
so
Get-Partition -DiskNumber 6 -PartitionNumber 2
returns the right partition and only that partition

to put it all together:
Resize-Partition -DiskNumber 6 -PartitionNumber 2 -size (2.5TB)

amazingly enough this DID work

so now the vdisk is 2.6TB and the S: drive is 2.5TB
the pool and therefore the vdisk having a hypothetical limit of 3.64TB or so

and indeed as reported on the server itself the S: is now 2.5TB and the data is still intact


what i would like to do as an experiment is set one of the physical disks "usage" from "auto-select" to "hotspare"
but i'm not sure if it can do that on the fly or if I have to remove the physical disk from the virtual disk
at the very least


i think i'll just try it and see what happens. i'm assuming it won't work this way
Set-PhysicalDisk -FriendlyName "ATA SAMSUNG HD103UJ" -Usage Hotspare
actually this is did work and it did come back with status "hot spare" and there are no errors

here's the current output of get-physicaldisk:

PS C:\Users\keith> Get-PhysicalDisk

DeviceId FriendlyName            SerialNumber    MediaType CanPool OperationalStatus HealthStatus Usage            Size
-------- ------------            ------------    --------- ------- ----------------- ------------ -----            ----
3        ATA SAMSUNG HD103UJ     S13PJDWQ728900  HDD       False   OK                Healthy      Hot Spare   931.51 GB
4        ATA WDC WD10EARS-00Y    WD-WCAV55704169 HDD       False   OK                Healthy      Auto-Select 931.51 GB
0        WDC  WDS500G2B0A-00SM50 191466802592    SSD       False   OK                Healthy      Auto-Select 465.76 GB
2        ATA Hitachi HDS5C302    MCE7215P0KMLAW  HDD       True    OK                Healthy      Auto-Select   1.82 TB
5        ATA WDC WD1001FALS-0    WD-WMATV8678792 HDD       False   OK                Healthy      Auto-Select 931.51 GB
1        ATA WDC WD1001FALS-0    WD-WMATV8730079 HDD       False   OK                Healthy      Auto-Select 931.51 GB

if i physically remove disk designated deviceid 4, i should then be able to set deviceID 3 from "hot spare" to "auto-select"
and possibly the array will recover


after the disk was physically removed:

DeviceId FriendlyName            SerialNumber    MediaType CanPool OperationalStatus  HealthStatus Usage           Size
-------- ------------            ------------    --------- ------- -----------------  ------------ -----           ----
3        ATA SAMSUNG HD103UJ     S13PJDWQ728900  HDD       False   OK                 Healthy      Auto-Select ...51 GB
         ATA WDC WD10EARS-00Y    WD-WCAV55704169 HDD       False   Lost Communication Warning      Retired     ...51 GB
0        WDC  WDS500G2B0A-00SM50 191466802592    SSD       False   OK                 Healthy      Auto-Select ...76 GB
2        ATA Hitachi HDS5C302    MCE7215P0KMLAW  HDD       True    OK                 Healthy      Auto-Select  1.82 TB
4        ATA WDC WD1001FALS-0    WD-WMATV8678792 HDD       False   OK                 Healthy      Auto-Select ...51 GB
1        ATA WDC WD1001FALS-0    WD-WMATV8730079 HDD       False   OK                 Healthy      Auto-Select ...51 GB

so apparently disk 3 auto-flagged itself over to "auto-select" without me
and the disconnected one auto-set to "retired"


so now to remove the retired one
by "friendly name" using
Remove-PhysicalDisk 

which can remove from both the vdisk and the storage pool
not sure which to do first though
though I would assume it's in reverse order of adding it
which i think would be 
remove from vidsk
then
remove from storage pool
but i could wrong about that


Remove-PhysicalDisk -VirtualDiskFriendlyName "Vdisk1" -PhysicalDisks (Get-PhysicalDisk -Friendlyname "ATA WDC WD10EARS-00Y")
and of course this didn't work
so i'll just do the storage pool instead


Remove-PhysicalDisk -StoragePoolFriendlyName "WinStorePool" -PhysicalDisks (Get-PhysicalDisk -Friendlyname "ATA WDC WD10EARS-00Y")

apparently this /did/ work

and data...remains intact

as random experiment i tried setting the vdisk 1 size to 50TB and...it worked
so theoretically i could...start adding 10TB disks into this pool/vdisk
while removing the smaller ones
i'll save that for tomorrow
not sure it's a good idea actually
i probably want to start over from scratch and really dial in the commands


-------------------------------------------------------------------------------------------------------------------

2:03 PM 9/2/2019


I re-inserted disk 4
came up with status:
4        ATA WDC WD10EARS-00Y    WD-WCAV55704169 Unspecified False   {Unrecognized Metadata, OK} Unhealthy    Unknown

so as before, i tried this command:
Reset-PhysicalDisk -FriendlyName "ATA WDC WD10EARS-00Y"

this came back with a normal "operational status" - healthy - but the "mediatype" was still "unspecified"
as before, the status then came back:
4        ATA WDC WD10EARS-00Y    WD-WCAV55704169 Unspecified True    OK                Healthy      Auto-Select ...1 GB

so as before, I ran this to fix that media type "unspecified"
Set-PhysicalDisk -FriendlyName "ATA WDC WD10EARS-00Y" -MediaType HDD

this has apparently fixed the status
I'm going to see if i can change it from "auto-select" to "hotswap"

hypothetically, this should work:
Set-PhysicalDisk -FriendlyName "ATA WDC WD10EARS-00Y" -usage HotSpare

This appears to have worked without issue
...and data intact as always

now i'll add the 2TB hitachi and maybe embiggen the disk/partition


I'll use this from above..
$PDToAdd =  Get-PhysicalDisk -FriendlyName "ATA Hitachi HDS5C302"
Add-PhysicalDisk -PhysicalDisks $PDToAdd -Usage AutoSelect -StoragePoolFriendlyName WinStorePool
this WORKED immediately and without issue. so i guess good
so the hitachi is already in the pool and part of the vdisk as far as i can tell


i just realized though that disk 4 designated as "hot spare" currently is actually "can pool" true
and apparently not in the pool and there not part of the vdisk
so I don't know if I even can though it says can pool true so maybe

so i'll just use the same as above in an attempt to add in the hot spare:

$PDToAdd =  Get-PhysicalDisk -FriendlyName "ATA WDC WD10EARS-00Y"
Add-PhysicalDisk -PhysicalDisks $PDToAdd -Usage AutoSelect -StoragePoolFriendlyName WinStorePool

this was successful but now disk 4 says usage is "auto-select"
so i think flagging it hot spare removed it from the pool
or the pool just can't have a disk flagged as hotspare
so i'm gong to reset it back to hotspare

ok i take it back. disk 4 is still in the pool but still flagged as hot spare
so i just had to add it to the pool at some point /then/ flag as hotspare


I'm going to try growing the vdisk/partition to around 3TB
first
Resize-VirtualDisk -FriendlyName "Vdisk1" -Size (3TB)
this didn't work because i had already set this capacity to 50TG
if i hadn't done that this would have worked. or I could size it to 50.2TB
ya, i'll do that
Resize-VirtualDisk -FriendlyName "Vdisk1" -Size (50.2TB)
yes. works. 


assume the vdisk works, i'll try this one

first verify with 
Get-Partition -DiskNumber 6 -PartitionNumber 2 

Then do the resize:

Resize-Partition -DiskNumber 6 -PartitionNumber 2 -size (3TB)

-----------------------------

I added one of the 8TB drives
the WD red from 2018 defcon
appparently the vdisk is now disk 7
the 8TB being disk 6

I'll just the same as before
first, add to the pool:
$PDToAdd =  Get-PhysicalDisk -FriendlyName "ATA WDC WD80EZAZ-11T"
Add-PhysicalDisk -PhysicalDisks $PDToAdd -Usage AutoSelect -StoragePoolFriendlyName WinStorePool


i think it's just available from there so next i'm almost positive is resizing the partition
lets find out
have to re-do that get-partition though

Get-Partition -DiskNumber 7 -PartitionNumber 2 
this confirms
so now i'll resize:
Resize-Partition -DiskNumber 7 -PartitionNumber 2 -size (5TB)


everything looked right with the pool and everything
it appeared the 8TB disk was part of it
but i also see the 8TB disk is D: on the server
with all the data
i used server manager to "reset" the disk effecitvely erasing it
now it's showing the status of the 8 TB as if it took it out:
DeviceId FriendlyName            SerialNumber    MediaType CanPool OperationalStatus  HealthStatus Usage           Size
-------- ------------            ------------    --------- ------- -----------------  ------------ -----           ----
6         ATA WDC WD80EZAZ-11T    1DGYWKZZ        HDD       False   Lost Communication Warning      Auto-Select  7.28 TB

so i'll try the thing from above for drives that actually were physically removed 
and see if that works
actually maybe that is possibly all this command does but i'll do it anyway
Reset-PhysicalDisk -FriendlyName "ATA WDC WD80EZAZ-11T"
actually this errored out but it still changed the status:
6        ATA WDC WD80EZAZ-11T    1DGYWKZZ        HDD       False   {Transient Error, OK} Unhealthy    Auto-Select ...TB


tried to find a command to fix the operational status of transient error/ok/unhealthy
so i tried removing:
Remove-PhysicalDisk -StoragePoolFriendlyName "WinStorePool" -PhysicalDisks (Get-PhysicalDisk -Friendlyname "ATA WDC WD80EZAZ-11T")
which seems to have gone through without much issue
now i'll tried adding it back

$PDToAdd = Get-PhysicalDisk -FriendlyName "ATA WDC WD80EZAZ-11T"
Add-PhysicalDisk -PhysicalDisks $PDToAdd -Usage AutoSelect -StoragePoolFriendlyName WinStorePool

this also was successful
and the status seems okay now
operational status "healthy"



I did re-format the vdisk volume as ReFS. probably does't matter but i did it anyway
and re-copied over the repo folder for some dummy data


the last experiment i can think of is swapping the position of two of the drives to see what happens and 
figure out if it's possible to recover without losing data

i swapped hdd positions, 0 (non-OS) with 1. it made literally no difference at all, the pool/disk just continuued
on as if nothing happened.

physical disk layout as of now:


PS C:\Users\keith> Get-PhysicalDisk

DeviceId FriendlyName            SerialNumber    MediaType CanPool OperationalStatus HealthStatus Usage            Size
-------- ------------            ------------    --------- ------- ----------------- ------------ -----            ----
3        ATA SAMSUNG HD103UJ     S13PJDWQ728900  HDD       False   OK                Healthy      Auto-Select 931.51 GB
4        ATA WDC WD10EARS-00Y    WD-WCAV55704169 HDD       False   OK                Healthy      Hot Spare   931.51 GB
0        WDC  WDS500G2B0A-00SM50 191466802592    SSD       False   OK                Healthy      Auto-Select 465.76 GB
1        ATA Hitachi HDS5C302    MCE7215P0KMLAW  HDD       False   OK                Healthy      Auto-Select   1.82 TB
5        ATA WDC WD1001FALS-0    WD-WMATV8678792 HDD       False   OK                Healthy      Auto-Select 931.51 GB
6        ATA WDC WD80EZAZ-11T    xxx        HDD       False   OK                Healthy      Auto-Select   7.28 TB
2        ATA WDC WD1001FALS-0    WD-WMATV8730079 HDD       False   OK                Healthy      Auto-Select 931.51 GB



i'm actually not sure parity+hot spare is necessary or required for redunduancy but i'm going to leave it like this for now 
anyway


i think the "friendly name" can actually be set. which since two of them have the same friendly name is probably a good thing to set



-------------------------------------------------------------------------------------------------------------------

9:38 PM 9/3/2019

found the command for changing friendly name
still not sure how to do this with the two disks with identical friendly names but
at least i got the command here

sample line
Set-PhysicalDisk -FriendlyName "PhysicalDisk4" -NewFriendlyName "PhysicalDiskInSlot5"

it took a while but if figured out i think how to identify hard drives that apparently have the same friendly name


Since get-physicaldisk can retreive a drive by serial number and this out put can be set to a variable:
$DiskToChange = Get-PhysicalDisk -SerialNumber WD-WMATV8730079

I took this and used it in a set-physicaldisk command:
Set-PhysicalDisk -InputObject $DiskToChange -Usage ManualSelect

apparently that was the right kind of InputObject

of coruse all the above does is set the usage to manual select 
i still need to try the new friendly name part

so i tried exactly that:
 Set-PhysicalDisk -InputObject $DiskToChange -NewFriendlyName "1TB ID 6"

and what do ya know:
 DeviceId FriendlyName SerialNumber    MediaType CanPool OperationalStatus HealthStatus Usage            Size
-------- ------------ ------------    --------- ------- ----------------- ------------ -----            ----
6        1TB ID 6     WD-WMATV8730079 HDD       False   OK                Healthy      Auto-Select 931.51 GB


now i could just use friendlyname/NewFriendlyName to change the other one if i wanted. now that the two have different friendly names

i probably shouldn't have mentioned the ID 6 though. I think that refers to the physical slot. so i move it, it could be confusing.




-------------------------------------------------------------------------------------------------------------------

10:30 PM 9/6/2019

i moved the drives int he server down so that the first two - i guess slot 0 and slot 1? - could hold the first two 
10TB drives
I then used server manager to delete the existing volumes and reset/initalize the disks
the two 10TB drives still showed "canpool" as "false" though
then i had to go so i powered off the server 
when i powered it back on again the drives showed "true" for "canpool"
at least i think that's the ordr of the events

the two 10TB drives again had identical "friendly names" however

first i set some new friendly names for the two drives by slot

$PDToAdd =  Get-PhysicalDisk -FriendlyName "10TB Slot ID1"
$PDToAdd =  Get-PhysicalDisk -FriendlyName "10TB Slot ID2"

then I added each one in turn with the above variable:
Add-PhysicalDisk -PhysicalDisks $PDToAdd -Usage AutoSelect -StoragePoolFriendlyName WinStorePool

here is current output of a 
Get-PhysicalDisk:

DeviceId FriendlyName            SerialNumber    MediaType CanPool OperationalStatus HealthStatus Usage            Size
-------- ------------            ------------    --------- ------- ----------------- ------------ -----            ----
3        ATA SAMSUNG HD103UJ     S13PJDWQ728900  HDD       False   OK                Healthy      Auto-Select 931.51 GB
4        ATA WDC WD10EARS-00Y    WD-WCAV55704169 HDD       False   OK                Healthy      Hot Spare   931.51 GB
2        10TB Slot ID2           xxx        HDD       False   OK                Healthy      Auto-Select    9.1 TB
1        10TB Slot ID1           xxx        HDD       False   OK                Healthy      Auto-Select    9.1 TB
0        500GB SSD OS            191466802592    SSD       False   OK                Healthy      Auto-Select 465.76 GB
6        2TB Hitachi             MCE7215P0KMLAW  HDD       False   OK                Healthy      Auto-Select   1.82 TB
5        1TB SN8792              WD-WMATV8678792 HDD       False   OK                Healthy      Auto-Select 931.51 GB
8        8TBWD SNWKZZ            xxx        HDD       False   OK                Healthy      Auto-Select   7.28 TB
7        1TB SN0079              WD-xxx HDD       False   OK                Healthy      Auto-Select 931.51 GB


i think the next step is probalby "extending" the volume. 
since i think the virtualdisk is likely still at the 50TB from my experimenting

FriendlyName ResiliencySettingName FaultDomainRedundancy OperationalStatus HealthStatus    Size FootprintOnPool StorageEfficiency
------------ --------------------- --------------------- ----------------- ------------    ---- --------------- -----------------
VDisk1       Parity                1                     OK                Healthy      50.2 TB           74 GB            64.86%


I'm actually not sure what the StorageEfficiency column is supposed to be indicating
i assume it's related to ratio of available physical disk space to specified virtual disk size 
but i actually don't know 

since i've only done volume resizing via server manager up to now i'll try it via PS


Resize-Partition -DiskNumber 6 -PartitionNumber 2 -size (2.5TB)


Resize-Partition -DiskNumber 9 -PartitionNumber 2 -size (12TB)


first, show the volume, S:, and only that:
Get-Partition -DiskNumber 9 -PartitionNumber 2

then, set to a variable:
$PartToResize = Get-Partition -DiskNumber 9 -PartitionNumber 2
now, perhaps we can use resize-partition 

actually that probably isn't necessary
Resize-Partition -DiskNumber 6 -PartitionNumber 2 -size (2.5TB)



this command did work, note no variable
Resize-Partition -DiskNumber 9 -PartitionNumber 2 -size (12TB)

I decided to raise it up to 20TB. Just for fun.
Resize-Partition -DiskNumber 9 -PartitionNumber 2 -size (20TB)
I also did a test copy of a 4+ gig ISO file and it seemed to max out the network bandwidth
when i did the inital test it seemed limited to less than 10Mbps
like it was on wifi or something
but I reset my modem's firware to default just using the web UI    
and it seems to be better now. 






-------------------------------------------------------------------------------------------------------------------

13:05 PM 9/14/2019


as part of a blog entry i removed disk 3:
3        ATA SAMSUNG HD103UJ     S13PJDWQ728900  HDD       False   OK                Healthy      Auto-Select 931.51 GB

and replaced it with a 10TB drive which I had already designated as the third one



I used only this or these commands:
$PDToRemove = Get-PhysicalDisk -Friendlyname "ATA SAMSUNG HD103UJ"
Remove-PhysicalDisk -PhysicalDisks $PDToRemove -StoragePoolFriendlyName "WinStorePool"

Not sure if more steps are necessary or not but it seems to have worked
as far as the health of the pool and the virtualdisk


once it was out of the pool i powered down the server, removed the disk and inserted the 10TB 

I ended up removing 3 of the 1TB disks and replacing them with the remaining 10TB drives (x3)

I kept track in a blog entry instad
But the basic commands are in these notes.



-------------------------------------------------------------------------------------------------------------------

18:00 PM 9/24/2019

I have installed node.js on the 2k19 host OS of the r520
which also installed chocolatey and few other things 
version is 12.10.0
actually took a while
after reboot I wanted to see if "windows terminal" would install or not 
and found a page that describes it: 
https://github.com/microsoft/terminal

with choco install:
choco install microsoft-windows-terminal

got the error:
ERROR: This package requires at least Windows 10 version 1903/OS build 18362.x.
there doesn't seem to be a way - right now - to install terminal on any version of
windows server
i had a little hope from this:
https://github.com/microsoft/terminal/issues/1386
downloading the appx zip file then downloading the msix file 
but windowsterminal.exe doesn't run 
so i tried installing the vc runtime
https://aka.ms/vs/16/release/vc_redist.x64.exe
and registering the appmanifest file 
Add-AppxPackage .\AppxManifest.xml -Register
but that had a different requirement: 
C++ Runtime framework packages for Desktop Bridge
https://support.microsoft.com/en-us/help/3176696/c-runtime-framework-packages-for-desktop-bridge
so installed /that/ 
I also edited the xml file to match the version i installed 
none of it works though. no acknowledgement that it's even installed



I've been looking up windows demployment services - still not sure if that requires a domain    
or not   (update: system requirements mention active directory so I think yes, domain required)
and also something called "boxstarter" (https://boxstarter.org/) 
"
Boxstarter leverages Chocolatey packages to automate the installation of software and create 
repeatable, scripted Windows environments.
"

which is literally what i've always wanted. or at least most of what i've always wanted 

i was also looking at windows deployment services information
found a playlist but it's about server 2012/r2:
https://www.youtube.com/watch?v=OaldxImiPNI&list=PL3wE5r2MTAlRyTxszpsn2tlxnqi8wGgmm&index=2

interesting information 
first adds role through server manager 
then does same through powershell prompt 

install feature first:
install-windowsfeature -name WDS 

-------------------------------------------------------------------------------------------------------------------

18:00 PM 10/2/2019

The issue lately has been that the vm - 180 trial server 2019 - has a network adapter
apparently connected to the virtual switch since it is on the network...
but the vm seems to have the same IP as the host which seems more like 
the "NAT" configuration of virtualbox

And before when i looked when i tried to get the name of the virtual nic - 
not the virtual switch - it would return the name of the virtualswitch

I've tried again though with 
Get-VMNetworkAdapter -VMName *

the output being:

Name            IsManagementOs VMName                      SwitchName MacAddress   Status IPAddresses
----            -------------- ------                      ---------- ----------   ------ -----------
Network Adapter False          Server 2019 (180 day trial)            00155DE0EA00        {}


So i guess there is a virtual nic seperate from the virtual switch just called "network adapter"


tangentially, 
Get-VMSwitch
returns 
Name            SwitchType NetAdapterInterfaceDescription
----            ---------- ------------------------------
ExternalSwitch1 External   Broadcom NetXtreme Gigabit Ethernet


I don't think i created the virtualnic at least not through powershell but 
i may have created the virtual switch or at least named it via 
the "vm manager" GUI 




-------------------------------------------------------------------------------------------------------------------

21:52  10/7/2019

since i bought 3 new 10TB drives from bb, I am inserting them into the server 
not sure if i can remove all the non-10TB drives at once or if i really have to do them 
one by one 
but I guess I'll find out 
so first command:

Remove-PhysicalDisk -StoragePoolFriendlyName "WinStorePool" -PhysicalDisks (Get-PhysicalDisk -Friendlyname "1TB SN0079")

this was for the 1TB drive and this was successful

next is the 8TB drive 
Remove-PhysicalDisk -StoragePoolFriendlyName "WinStorePool" -PhysicalDisks (Get-PhysicalDisk -Friendlyname "8TBWD SNWKZZ")

this is the 8TB. probably obvious. this also is good so far



last is the 2TB, 2TB Hitachi

Apparently it found the limit of what it will tolerate as it did not let me remove the hitachi
so i'll power down and insert 2x10TB to add to array

error info:
Remove-PhysicalDisk : One or more physical disks could not be removed because they are still in use.

Extended information:
The storage pool could not relocate data from one or more physical disks.


per usual the two 10TB drives have the same friendly name so I'll use the command as before:

first one: 
$DiskToChange = Get-PhysicalDisk -SerialNumber 1EG5JZGZ
Set-PhysicalDisk -InputObject $DiskToChange -NewFriendlyName "10TB Slot ID7"


second one:
$DiskToChange = Get-PhysicalDisk -SerialNumber 1EG4028Z
Set-PhysicalDisk -InputObject $DiskToChange -NewFriendlyName "10TB Slot ID8"


now that they have different friendly names, I need to add them to the pool and vdisk 


starting with 7:

$PDToAdd =  Get-PhysicalDisk -FriendlyName "10TB Slot ID7"
Add-PhysicalDisk -PhysicalDisks $PDToAdd -Usage AutoSelect -StoragePoolFriendlyName WinStorePool

now same with 8:

$PDToAdd =  Get-PhysicalDisk -FriendlyName "10TB Slot ID8"
Add-PhysicalDisk -PhysicalDisks $PDToAdd -Usage AutoSelect -StoragePoolFriendlyName WinStorePool


both of these apparently got added no problem (see below)
the hitachi is "retired" for some reason, not sure why

i'll try removing it again


DeviceId FriendlyName            SerialNumber   MediaType CanPool OperationalStatus HealthStatus Usage            Size
-------- ------------            ------------   --------- ------- ----------------- ------------ -----            ----
2        10TB Slot ID2           JEH8JZYN       HDD       False   OK                Healthy      Auto-Select    9.1 TB
1        10TB Slot ID1           2YJ3NGWD       HDD       False   OK                Healthy      Auto-Select    9.1 TB
0        WDC  WDS500G2B0A-00SM50 191466802592   SSD       False   OK                Healthy      Auto-Select 465.76 GB
6        2TB Hitachi             MCE7215P0KMLAW HDD       False   OK                Healthy      Retired       1.82 TB
8        10TB Slot ID8           1EG4028Z       HDD       False   OK                Healthy      Auto-Select    9.1 TB
3        10TB Slot ID3           2YJPAL5D       HDD       False   OK                Healthy      Auto-Select    9.1 TB
7        10TB Slot ID7           1EG5JZGZ       HDD       False   OK                Healthy      Auto-Select    9.1 TB
4        10TB Slot ID4           2YJS31ND       HDD       False   OK                Healthy      Auto-Select    9.1 TB
5        10TB Slot ID5           16G6D0HZ       HDD       False   OK                Healthy      Auto-Select    9.1 TB


removal of hitachi:
Remove-PhysicalDisk -StoragePoolFriendlyName "WinStorePool" -PhysicalDisks (Get-PhysicalDisk -Friendlyname "2TB Hitachi")

went through this time

powered off
removed 2TB, inserted 10TB 
same lines as before
$DiskToChange = Get-PhysicalDisk -SerialNumber 1EG4UGWZ
Set-PhysicalDisk -InputObject $DiskToChange -NewFriendlyName "10TB Slot ID6"





















